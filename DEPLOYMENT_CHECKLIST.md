# 广告系统部署检查清单

## 📋 部署前检查

### 代码完整性
- [x] database.py 已添加 ads_enabled 字段
- [x] admin.py 已添加 toggle_ads 路由
- [x] layout.html 已添加 3 个广告位置
- [x] admin_panel.html 已添加控制按钮
- [x] 所有 Python 文件语法正确
- [x] 所有模板文件语法正确

### 文档完整性
- [x] AD_SYSTEM_IMPLEMENTATION.md - 技术实现文档
- [x] ADMIN_AD_CONTROL_GUIDE.md - 使用指南
- [x] AD_SYSTEM_CHANGES_SUMMARY.md - 更改摘要
- [x] test_ads_system.py - 测试脚本
- [x] DEPLOYMENT_CHECKLIST.md - 本检查清单

## 🚀 部署步骤

### 1. 备份现有数据 ⏳
```bash
# 备份数据库
cp instance/app.db instance/app.db.backup_$(date +%Y%m%d_%H%M%S)

# 备份模板（如果已修改过）
tar -czf templates_backup_$(date +%Y%m%d_%H%M%S).tar.gz project/templates/
```

### 2. 验证代码 ⏳
```bash
# 运行测试脚本
python3 test_ads_system.py
```

### 3. 重启应用 ⏳
```bash
# 如果使用 systemd
sudo systemctl restart your-app-name

# 或者直接运行
python3 run.py
```

## ✅ 部署后验证

### 基本功能测试 ⏳
1. [ ] 访问管理面板 `/admin/`
2. [ ] 登录管理员账号
3. [ ] 找到「广告」按钮
4. [ ] 点击按钮查看确认对话框
5. [ ] 确认操作并等待刷新
6. [ ] 验证按钮状态已更新

### 广告显示测试 ⏳
**测试场景 1: 开启广告**
1. [ ] 点击广告按钮开启广告
2. [ ] 访问首页
3. [ ] 按 F12 打开开发者工具
4. [ ] 在 Elements 标签中搜索 "10228913"
5. [ ] 应该找到 3 个广告脚本

**测试场景 2: 关闭广告**
1. [ ] 点击广告按钮关闭广告
2. [ ] 访问首页
3. [ ] 按 F12 打开开发者工具
4. [ ] 在 Elements 标签中搜索 "10228913"
5. [ ] 不应该找到任何广告脚本

### 浏览器兼容性测试 ⏳
- [ ] Chrome/Edge - 广告正常显示
- [ ] Firefox - 广告正常显示
- [ ] Safari - 广告正常显示
- [ ] 移动浏览器 - 广告正常显示

### 性能测试 ⏳
- [ ] 页面加载时间未明显增加
- [ ] 广告脚本异步加载不阻塞页面
- [ ] CPU 使用率正常
- [ ] 内存使用正常

## 🔧 故障排查

### 问题 1: 按钮点击无反应
**排查步骤**:
1. [ ] 检查浏览器控制台是否有 JavaScript 错误
2. [ ] 确认已登录管理员账号
3. [ ] 检查网络请求是否成功 (Network 标签)
4. [ ] 查看 error.log 文件

### 问题 2: 广告未显示
**排查步骤**:
1. [ ] 确认广告状态为「已开启」
2. [ ] 清除浏览器缓存
3. [ ] 禁用广告拦截插件
4. [ ] 检查 nap5k.com 是否可访问
5. [ ] 查看控制台网络请求

### 问题 3: 页面刷新失败
**排查步骤**:
1. [ ] 检查浏览器控制台错误
2. [ ] 手动刷新页面 (F5)
3. [ ] 清除浏览器缓存
4. [ ] 重新登录

## 📊 监控指标

### 初期监控 (前 7 天)
- [ ] 每日广告展示次数
- [ ] 每日广告点击次数
- [ ] 用户反馈收集
- [ ] 页面加载速度
- [ ] 服务器资源使用

### 长期监控 (持续)
- [ ] 月度广告收益
- [ ] 用户留存率变化
- [ ] 页面跳出率变化
- [ ] 服务器负载趋势

## 🎯 成功标准

- ✅ 管理员可以正常开关广告
- ✅ 广告开启时在所有页面显示
- ✅ 广告关闭时完全不显示
- ✅ 按钮状态准确反映当前状态
- ✅ 页面性能未受影响
- ✅ 无 JavaScript 错误
- ✅ 所有浏览器兼容

## 📝 部署记录

**部署人员**: _______________  
**部署日期**: _______________  
**部署时间**: _______________  
**服务器**: _______________  
**版本**: 1.0.0  

**测试结果**:
- [ ] 所有测试通过
- [ ] 部分测试通过（需记录问题）
- [ ] 测试未通过（需回滚）

**备注**:
_______________________________
_______________________________
_______________________________

## 🔄 回滚方案

如果部署后出现严重问题，执行以下步骤回滚：

### 1. 恢复数据库
```bash
cp instance/app.db.backup_YYYYMMDD_HHMMSS instance/app.db
```

### 2. 恢复模板文件
```bash
tar -xzf templates_backup_YYYYMMDD_HHMMSS.tar.gz
```

### 3. 重启应用
```bash
sudo systemctl restart your-app-name
```

### 4. 验证回滚成功
- [ ] 应用正常启动
- [ ] 管理面板可访问
- [ ] 广告按钮消失（如预期）

## ✨ 下一步

- [ ] 监控广告数据
- [ ] 收集用户反馈
- [ ] 优化广告位置
- [ ] 计划未来改进

---

**状态**: 🟡 待部署  
**优先级**: ⭐⭐⭐⭐⭐  
**预计影响**: 正面 - 增加广告收益  
