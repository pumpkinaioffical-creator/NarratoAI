# WebSocket Spaces å¿«é€Ÿæµ‹è¯•æŒ‡å—

## ğŸ¯ ç›®æ ‡

éªŒè¯WebSocket Spacesç³»ç»Ÿæ˜¯å¦èƒ½å¤Ÿæ­£ç¡®è¿è¡Œã€‚

---

## âœ… å‰ç½®æ¡ä»¶æ£€æŸ¥

### æ£€æŸ¥1: è™šæ‹Ÿç¯å¢ƒ
```bash
# æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒæ˜¯å¦å·²åˆ›å»º
ls -la /tmp/ws_test_env
# åº”è¯¥æ˜¾ç¤º: ç›®å½•å­˜åœ¨
```

### æ£€æŸ¥2: ä¾èµ–
```bash
source /tmp/ws_test_env/bin/activate
pip list | grep -E "Flask|socketio"
# åº”è¯¥æ˜¾ç¤º:
# Flask-SocketIO
# python-socketio
# python-engineio
```

### æ£€æŸ¥3: æ ¸å¿ƒæ–‡ä»¶
```bash
cd /home/engine/project
ls -1 project/websocket*.py mock_app.py test_websockets.py
# åº”è¯¥æ˜¾ç¤ºæ‰€æœ‰5ä¸ªæ–‡ä»¶
```

---

## ğŸš€ å®Œæ•´æµ‹è¯•æµç¨‹

### é˜¶æ®µ1: å•å…ƒçº§éªŒè¯ (2åˆ†é’Ÿ)

**è¿è¡Œæµ‹è¯•è„šæœ¬:**
```bash
source /tmp/ws_test_env/bin/activate
cd /home/engine/project
bash run_full_test.sh
```

**æœŸæœ›è¾“å‡º:**
```
âœ… æ‰€æœ‰ä»£ç éªŒè¯é€šè¿‡ï¼
âœ“ websocket_manager å¯å¯¼å…¥
âœ“ WebSocketManager.register_connection å­˜åœ¨
âœ“ MockInferenceApp å®ä¾‹åŒ–æˆåŠŸ
âœ“ WebSocketTester å®ä¾‹åŒ–æˆåŠŸ
```

---

### é˜¶æ®µ2: é›†æˆæµ‹è¯• (5åˆ†é’Ÿ - 3ä¸ªç»ˆç«¯)

#### ç¬¬1ä¸ªç»ˆç«¯: å¯åŠ¨ç½‘ç«™æœåŠ¡å™¨

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source /tmp/ws_test_env/bin/activate

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/engine/project

# å¯åŠ¨Flaskåº”ç”¨
python run.py
```

**æœŸæœ›è¾“å‡º:**
```
 * Running on http://0.0.0.0:5001
 * WARNING: This is a development server...
```

**âœ… éªŒè¯**: æœåŠ¡å™¨æˆåŠŸå¯åŠ¨åœ¨ http://localhost:5001

---

#### ç¬¬2ä¸ªç»ˆç«¯: åˆ›å»ºæµ‹è¯•ç©ºé—´

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source /tmp/ws_test_env/bin/activate

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/engine/project

# åˆ›å»ºæµ‹è¯•ç©ºé—´
python test_websockets.py --setup-space --host http://localhost:5001
```

**æœŸæœ›è¾“å‡º:**
```
Creating test WebSocket space...
Host: http://localhost:5001
Admin User: admin

âœ“ Space created: TestSpace_1704123456

Now run the mock app with:
  python mock_app.py --host http://localhost:5001 --spaces "TestSpace_1704123456"
```

**ğŸ“ é‡è¦**: å¤åˆ¶ `TestSpace_1704123456` è¿™ä¸ªåç§°ï¼Œåœ¨ç¬¬3ä¸ªç»ˆç«¯ä¸­ä½¿ç”¨

---

#### ç¬¬3ä¸ªç»ˆç«¯: å¯åŠ¨æ¨¡æ‹Ÿåº”ç”¨

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source /tmp/ws_test_env/bin/activate

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/engine/project

# å¯åŠ¨æ¨¡æ‹Ÿåº”ç”¨ (ä½¿ç”¨ç¬¬2ä¸ªç»ˆç«¯è¾“å‡ºçš„spaceåç§°)
python mock_app.py --host http://localhost:5001 --spaces "TestSpace_1704123456" --verbose
```

**æœŸæœ›è¾“å‡º:**
```
======================================================================
  Mock WebSocket Inference App
======================================================================
  Host: http://localhost:5001
  Space: TestSpace_1704123456
  Verbose: True
======================================================================

[2024-01-08 12:00:00] [INFO] Initializing connection to http://localhost:5001
[2024-01-08 12:00:00] [âœ“] Socket.IO connection established
[2024-01-08 12:00:00] [INFO] Sent registration for space: TestSpace_1704123456
[2024-01-08 12:00:00] [âœ“] Registration successful!
[2024-01-08 12:00:00] [INFO] Connection ID: abc123def456
[2024-01-08 12:00:00] [INFO] Request processor started
```

**âœ… éªŒè¯**: 
- çœ‹åˆ° `Socket.IO connection established` - è¿æ¥æˆåŠŸ
- çœ‹åˆ° `Registration successful!` - æ³¨å†ŒæˆåŠŸ
- çœ‹åˆ° `Request processor started` - è¯·æ±‚å¤„ç†å™¨å¯åŠ¨

---

#### ç¬¬4æ­¥: åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•

**æ‰“å¼€æµè§ˆå™¨:**
```
http://localhost:5001
```

**ç™»å½•:**
- ç”¨æˆ·å: admin (æˆ–åˆ›å»ºæ–°ç”¨æˆ·)
- å¯†ç : å¯¹åº”çš„å¯†ç 

**æ‰¾åˆ°ä½ çš„ç©ºé—´:**
- æµè§ˆé¦–é¡µæˆ–Adminé¡µé¢
- æ‰¾åˆ° `TestSpace_1704123456`

**éªŒè¯è¿æ¥çŠ¶æ€:**
```
åº”è¯¥çœ‹åˆ°: âœ“ å·²è¿æ¥ (ç»¿è‰²)
æˆ–è‹±æ–‡:  âœ“ Connected (green)
```

**æäº¤æ¨ç†è¯·æ±‚:**
1. åœ¨ç©ºé—´é¡µé¢çš„è¡¨å•ä¸­è¾“å…¥æç¤ºè¯
   - ä¾‹å¦‚: "å†™ä¸€é¦–å…³äºPythonçš„è¯—"
2. ç‚¹å‡» "å‘é€è¯·æ±‚" æˆ– "Submit Request" æŒ‰é’®
3. çœ‹åˆ°è¯·æ±‚IDæ˜¾ç¤ºåœ¨é¡µé¢ä¸Š

**è§‚å¯Ÿæ¨¡æ‹Ÿåº”ç”¨å¤„ç†:**
åœ¨ç¬¬3ä¸ªç»ˆç«¯ä¸­ï¼Œåº”è¯¥çœ‹åˆ°:
```
[2024-01-08 12:01:00] [REQUEST] New inference request received
[2024-01-08 12:01:00] [DEBUG] Request ID: abc123def456-xyz789
[2024-01-08 12:01:00] [DEBUG] Username: admin
[2024-01-08 12:01:00] [INFO] Starting inference for request abc123de...
[2024-01-08 12:01:00] [DEBUG] Progress: 25%
[2024-01-08 12:01:01] [DEBUG] Progress: 50%
[2024-01-08 12:01:02] [DEBUG] Progress: 75%
[2024-01-08 12:01:02] [âœ“] Inference completed for request abc123de in 2.3s
[2024-01-08 12:01:02] [RESULT] Result sent for request abc123de
```

**åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°ç»“æœ:**
```
å¤„ç†æ—¶é—´: 2.3ç§’
ç½®ä¿¡åº¦: 0.95
æ¨¡å‹: gpt-4-turbo
Tokenæ•°: 245
è¾“å‡ºæ–‡æœ¬: ...
```

---

## ğŸ§ª åœºæ™¯æµ‹è¯•

### åœºæ™¯1: å¤šä¸ªå¹¶å‘è¯·æ±‚

**åœ¨æµè§ˆå™¨ä¸­:**
1. æ‰“å¼€3ä¸ªæ ‡ç­¾é¡µï¼Œéƒ½æ‰“å¼€åŒä¸€ä¸ªspace
2. åœ¨ç¬¬1ä¸ªæ ‡ç­¾é¡µæäº¤è¯·æ±‚ "è¯·æ±‚1"
3. åœ¨ç¬¬2ä¸ªæ ‡ç­¾é¡µæäº¤è¯·æ±‚ "è¯·æ±‚2"  
4. åœ¨ç¬¬3ä¸ªæ ‡ç­¾é¡µæäº¤è¯·æ±‚ "è¯·æ±‚3"

**è§‚å¯Ÿæ¨¡æ‹Ÿåº”ç”¨:**
```
[REQUEST] New inference request received (ID: req1)
[REQUEST] New inference request received (ID: req2)
[REQUEST] New inference request received (ID: req3)
  Queue size: 1, 2, 3
  
[INFO] Starting inference for request req1...
[RESULT] Result sent for request req1

[INFO] Starting inference for request req2...
[RESULT] Result sent for request req2

[INFO] Starting inference for request req3...
[RESULT] Result sent for request req3
```

**âœ… éªŒè¯**: æ‰€æœ‰3ä¸ªè¯·æ±‚éƒ½è¢«ä¾æ¬¡å¤„ç†

---

### åœºæ™¯2: åº”ç”¨æ–­å¼€è¿æ¥

**åœ¨ç¬¬3ä¸ªç»ˆç«¯:**
1. æŒ‰ `Ctrl+C` åœæ­¢æ¨¡æ‹Ÿåº”ç”¨
2. è§‚å¯Ÿæµè§ˆå™¨

**æµè§ˆå™¨ä¸­:**
```
åº”è¯¥çœ‹åˆ°: âœ— æœªè¿æ¥ (çº¢è‰²)
æˆ–è‹±æ–‡:   âœ— Not Connected (red)

è¡¨å•åº”è¯¥è¢«ç¦ç”¨
```

**å°è¯•æäº¤è¯·æ±‚:**
```
åº”è¯¥çœ‹åˆ°é”™è¯¯: "è¿œç¨‹åº”ç”¨æœªè¿æ¥"
æˆ–è‹±æ–‡:     "Remote app not connected"
```

**é‡æ–°å¯åŠ¨æ¨¡æ‹Ÿåº”ç”¨:**
```bash
python mock_app.py --host http://localhost:5001 --spaces "TestSpace_1704123456" --verbose
```

**æµè§ˆå™¨ä¸­:**
```
åº”è¯¥çœ‹åˆ°: âœ“ å·²è¿æ¥ (ç»¿è‰²)
è¡¨å•åº”è¯¥é‡æ–°å¯ç”¨
```

**æ–°è¯·æ±‚åº”è¯¥å¯ä»¥æˆåŠŸæäº¤**

---

### åœºæ™¯3: é‡å¤çš„ç©ºé—´åç§°

**åœ¨ç»ˆç«¯ä¸­å°è¯•åˆ›å»ºé‡å¤çš„ç©ºé—´:**
```bash
# å…ˆåˆ›å»ºç¬¬ä¸€ä¸ªspace: TestSpace_DUP
# å†åˆ›å»ºç¬¬äºŒä¸ªspace: TestSpace_DUP (ç›¸åŒçš„åç§°)

# å°è¯•è¿æ¥ç¬¬ä¸€ä¸ª
python mock_app.py --host http://localhost:5001 --spaces "TestSpace_DUP" --verbose
# åº”è¯¥æˆåŠŸ

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯å°è¯•è¿æ¥ç¬¬äºŒä¸ª
python mock_app.py --host http://localhost:5001 --spaces "TestSpace_DUP" --verbose
```

**æœŸæœ›è¾“å‡º:**
```
âœ— Registration failed: Multiple spaces with name "TestSpace_DUP" found. 
  Please use unique space names.
```

**âœ… éªŒè¯**: é‡å¤çš„spaceåç§°è¢«æ­£ç¡®æ‹’ç»

---

## ğŸ“Š æµ‹è¯•ç»“æœæ£€æŸ¥æ¸…å•

æ‰“å°è¿™ä¸ªæ¸…å•ï¼Œæ¯ä¸ªé€šè¿‡çš„é¡¹ç›®æ‰“å‹¾:

```
åŸºç¡€éªŒè¯:
[ ] ä»£ç æ–‡ä»¶éƒ½å­˜åœ¨ (5ä¸ªå…³é”®æ–‡ä»¶)
[ ] æ‰€æœ‰æ¨¡å—éƒ½å¯å¯¼å…¥
[ ] æ‰€æœ‰ç±»éƒ½å¯å®ä¾‹åŒ–
[ ] æ‰€æœ‰æ–¹æ³•éƒ½å·²å®ç°

é›†æˆæµ‹è¯•:
[ ] ç½‘ç«™æœåŠ¡å™¨æˆåŠŸå¯åŠ¨
[ ] æµ‹è¯•ç©ºé—´æˆåŠŸåˆ›å»º
[ ] æ¨¡æ‹Ÿåº”ç”¨æˆåŠŸè¿æ¥
[ ] æµè§ˆå™¨æ˜¾ç¤º âœ“ å·²è¿æ¥

åŠŸèƒ½æµ‹è¯•:
[ ] å¯ä»¥æäº¤å•ä¸ªè¯·æ±‚
[ ] æ¨¡æ‹Ÿåº”ç”¨æ¥æ”¶è¯·æ±‚
[ ] æ¨¡æ‹Ÿåº”ç”¨è¿”å›ç»“æœ
[ ] æµè§ˆå™¨æ˜¾ç¤ºç»“æœ

å¹¶å‘æµ‹è¯•:
[ ] å¯ä»¥åŒæ—¶æäº¤å¤šä¸ªè¯·æ±‚
[ ] è¯·æ±‚è¢«æ­£ç¡®æ’é˜Ÿ
[ ] æ‰€æœ‰è¯·æ±‚éƒ½å¾—åˆ°å¤„ç†
[ ] æ‰€æœ‰ç”¨æˆ·éƒ½è·å¾—ç»“æœ

è¿æ¥æµ‹è¯•:
[ ] åº”ç”¨æ–­å¼€è¿æ¥æ—¶çŠ¶æ€æ›´æ–°
[ ] è¡¨å•åœ¨æ–­å¼€è¿æ¥æ—¶ç¦ç”¨
[ ] åº”ç”¨é‡æ–°è¿æ¥æ—¶çŠ¶æ€æ›´æ–°
[ ] æ–°è¯·æ±‚å¯ä»¥æ­£å¸¸å·¥ä½œ

å®‰å…¨æµ‹è¯•:
[ ] é‡å¤çš„spaceåç§°è¢«æ‹’ç»
[ ] æœªæˆæƒè®¿é—®è¢«æ‹’ç»
[ ] é”™è¯¯æ¶ˆæ¯æ¸…æ™°æ˜äº†

æ€»åˆ†: ___ / 18 é¡¹
```

---

## âœ… æˆåŠŸæ ‡å‡†

### æœ€å°é€šè¿‡æ ‡å‡†
- [x] æ‰€æœ‰ä»£ç æ–‡ä»¶å­˜åœ¨
- [x] æ‰€æœ‰æ¨¡å—å¯å¯¼å…¥
- [x] ç½‘ç«™å¯å¯åŠ¨
- [x] æ¨¡æ‹Ÿåº”ç”¨å¯è¿æ¥
- [x] å¯ä»¥æäº¤è¯·æ±‚
- [x] å¯ä»¥è·å¾—ç»“æœ

### å®Œæ•´é€šè¿‡æ ‡å‡†
æ‰€æœ‰ä¸Šè¿°æ¸…å•é¡¹éƒ½æ‰“å‹¾

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1: è™šæ‹Ÿç¯å¢ƒä¸å­˜åœ¨

**ç—‡çŠ¶**: `source: command not found` æˆ– `/tmp/ws_test_env` ä¸å­˜åœ¨

**è§£å†³**:
```bash
python3 -m venv /tmp/ws_test_env
source /tmp/ws_test_env/bin/activate
pip install Flask Flask-SocketIO Flask-Babel python-socketio python-engineio requests
```

---

### é—®é¢˜2: æ¨¡å—å¯¼å…¥é”™è¯¯

**ç—‡çŠ¶**: `ModuleNotFoundError: No module named 'flask'`

**è§£å†³**:
```bash
source /tmp/ws_test_env/bin/activate
pip install -r /home/engine/project/requirements.txt
pip install Flask-SocketIO python-socketio python-engineio
```

---

### é—®é¢˜3: æ— æ³•è¿æ¥åˆ°ç½‘ç«™

**ç—‡çŠ¶**: `ConnectionRefusedError` æˆ– `Failed to connect`

**è§£å†³**:
1. ç¡®ä¿ç¬¬1ä¸ªç»ˆç«¯çš„ç½‘ç«™æœåŠ¡å™¨ä»åœ¨è¿è¡Œ
2. æ£€æŸ¥ç½‘ç«™æ˜¯å¦åœ¨ http://localhost:5001
3. æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å…è®¸localhostè¿æ¥

---

### é—®é¢˜4: æ¨¡æ‹Ÿåº”ç”¨æ— æ³•è¿æ¥

**ç—‡çŠ¶**: `Registration failed: Space not found`

**è§£å†³**:
1. æ£€æŸ¥spaceåç§°æ˜¯å¦å®Œå…¨åŒ¹é…ï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰
2. ç¡®ä¿ä½¿ç”¨äº†ç¬¬2ä¸ªç»ˆç«¯è¾“å‡ºçš„spaceåç§°
3. æ£€æŸ¥spaceç±»å‹æ˜¯å¦ä¸º "WebSocket"

---

### é—®é¢˜5: è¯·æ±‚æœªåˆ°è¾¾æ¨¡æ‹Ÿåº”ç”¨

**ç—‡çŠ¶**: åœ¨æ¨¡æ‹Ÿåº”ç”¨ä¸­çœ‹ä¸åˆ° `[REQUEST]` æ¶ˆæ¯

**è§£å†³**:
1. æ£€æŸ¥æµè§ˆå™¨ä¸­æ˜¯å¦æ˜¾ç¤º `âœ“ å·²è¿æ¥`
2. æ£€æŸ¥æ¨¡æ‹Ÿåº”ç”¨æ˜¯å¦æ˜¾ç¤º `Registration successful`
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°(F12)æ˜¯å¦æœ‰é”™è¯¯

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **å¦‚æœæ‰€æœ‰æµ‹è¯•é€šè¿‡**:
   - âœ… ç³»ç»Ÿå¯ä»¥åˆå¹¶åˆ°mainåˆ†æ”¯
   - âœ… å¯ä»¥è¿›è¡Œç”¨æˆ·éªŒæ”¶æµ‹è¯•
   - âœ… å¯ä»¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

2. **å¦‚æœæœ‰å¤±è´¥**:
   - æŸ¥çœ‹ä¸Šé¢çš„æ•…éšœæ’é™¤éƒ¨åˆ†
   - æ£€æŸ¥é”™è¯¯æ—¥å¿—
   - æŸ¥çœ‹ `TESTING_WEBSOCKETS.md` è·å–æ›´å¤šå¸®åŠ©

---

## ğŸ“ è·å–æ›´å¤šå¸®åŠ©

- **å¿«é€Ÿå…¥é—¨**: [START_HERE.md](START_HERE.md)
- **è¯¦ç»†æµ‹è¯•**: [TESTING_WEBSOCKETS.md](TESTING_WEBSOCKETS.md)
- **æ•…éšœæ’é™¤**: [TESTING_WEBSOCKETS.md#troubleshooting](TESTING_WEBSOCKETS.md#troubleshooting)
- **æŠ€æœ¯ç»†èŠ‚**: [WEBSOCKETS_IMPLEMENTATION_SUMMARY.md](WEBSOCKETS_IMPLEMENTATION_SUMMARY.md)

---

## ğŸ“ æµ‹è¯•è®°å½•

**æµ‹è¯•äººå‘˜**: ___________________  
**æµ‹è¯•æ—¥æœŸ**: ___________________  
**æµ‹è¯•ç¯å¢ƒ**: Python 3.12 è™šæ‹Ÿç¯å¢ƒ (/tmp/ws_test_env)  

**æœ€ç»ˆç»“æœ**: 
- [ ] âœ… å…¨éƒ¨é€šè¿‡
- [ ] âš ï¸ éƒ¨åˆ†é€šè¿‡
- [ ] âŒ æœ‰å¤±è´¥

**å¤‡æ³¨**: _________________________________________________________________

---

**æµ‹è¯•å®Œæˆï¼** ğŸ‰

å¦‚æœæ‰€æœ‰é¡¹éƒ½é€šè¿‡äº†ï¼Œæ­å–œæ‚¨ï¼WebSocket Spacesç³»ç»Ÿå·²å‡†å¤‡å¥½éƒ¨ç½²ã€‚

